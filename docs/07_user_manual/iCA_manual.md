Image Colour Analysis (iCA)

**PLEASE READ BEFORE USING THE APP**

This is an user manual of our interactive dashboard, iCA (image Colour Analysis) using [plotly dash](https://www.kdnuggets.com/2018/05/overview-dash-python-framework-plotly-dashboards.html). 
It lets users play around with colour features and camera effect data for each rock type and detect which images have unusual behaviours. It can also be used for image quality check. The dashboard can be easily used in local computer and it can also be deployed on a local network.

### Quickstart

First, download the source code for this application from Gitlab by typing the following code in Terminal/Git bash:

```
git clone https://gitlab.com/mfqqio/ubc_geodetection_review.git
```

After that, navigate to the iCA folder:

```
cd ironn/modules/dashboards/iCA
```

Create an environment with virtualenv or conda. For conda,

```
conda create --name plotly_viz python=3.6
source activate plotly_viz

# For Windows users, instead use:
 
virtualenv plotly_viz
plotly_viz\Scripts\activate

if there is no package called `virtualenv`, you can simply install it by typing:

pip install virtualenv
```

Install necessary packages in requirements.txt.

```
pip install -r requirements.txt
```

Launch the app. You can specify the input feature file path. Currently, the feature file path is "../output/complete_joined_df.csv". 

```
python app.py --input_csv_path "../../output/complete_joined_df.csv"

For Window users, use "\" instead of "/"
```

The app can be opened only in local machine by clicking on http://127.0.0.1:8050/.

Once you have finished doing the analysis, hit CTRL+C to quit the app in the command line and exit the virtual environment by typing 

```
deactivate
```

When you want to launch the app again locally, you can simply navigate to `iCA` folder and type:

```
Step 1: 
source activate plotly_viz # For Mac users
plotly_viz\Scripts\activate # For Windows users

Step 2:
python app.py --input_csv_path "../output/complete_joined_df.csv"

For Window users, use "\" instead of "/"
```


### How to use the App

iCA contains two tabs: colour analysis and camera effect.

__Note:__ 

- This app ONLY considers rock types and camera feature values which have more than 10 occurrences.

- This app may crash and it will quit itself immediately. In order to relaunch the app, type the commands mentioned above.

#### Tab 1: Colour Analysis

You will be asked to enter your user ID before conducting colour analysis.

You can specify the following features in order to generate analysis graphs and tables:

- colour feature: options are `Skewness`, `Kurtosis`, `MeanPixel`; default value is `Skewness`.
- colour channel: options are `Blue`, `Green`, `Red`; default value is `Red`.
- rock type tier: options are `CombinedType`, `Type`; default value is `Type`.
	- `CombinedType` means tier I ((easiest tier) rocks, which includes ore, contaminant waste (CW), and dilution waste (DW).
	- `Type` means tier II rocks, which includes individual rocks such as AMP, WSIF, GN, QR, MS, HEM, MAG, SIF, IFG, and LIM1.
- rock types (multi-selection options): 
	- If `Type` is selected, options will be individual rock types; default value is `HEM`.
	- If `CombinedType` is selected, options will be tier I rocks; default value is `ORE`.

The plot can be generated by clicking on `RUN ANALYSIS` button.

If you want to examine images that contain outstanding values for certain feature, you may  select the lower and upper bounds of the feature value. For example, if you want to find images that contain a very high mean pixel value on red channel (e.g., 200 - 255), you can enter 200 and 255 as the lower and upper bound, respectively. Then, hit on the `GENERATE TABLE` button: a table which contains image file id, rock type, colour features, and camera features will be created. If you want to download the table locally (in the `results` folder), click on the `SAVE TABLE` button. The file name of the table will be shown below the button. 

#### Tab 2: Camera Effect

This tab allows the user to explore the camera effects on the colour features of each rock type.

Again, you will be asked to enter your used ID.

You can specify the following features to create graphs and tables:

- colour feature: same as the colour feature in Colour Analysis tab.
- colour channel: same as the colour channel in Colour Analysis tab.
- rock type tier: same as the rock tier in Colour Analysis tab.
- rock type: similar to rock type in Colour Analysis tab, but ONLY one rock type can be selected in this tab.
	- If `Type` is selected, options will be individual rock types; default value is `HEM`.
	- If `CombinedType` is selected, options will be tier I rocks; default value is `ORE`.
- camera feature: options are `Camera Model`, `Focal Length`, `Lens Aperture`, `Zoom-in Degree`, `Exposure Time`, `Megapixel`, and `Pixel Size`; default value is `Camera Model`.
- camera feature value (multi-selection options):
	- If `Camera Model` is selected, options are `iPhone 6`, `Pixel 2` and `Canon PowerShot SX20 IS`, etc. 
	- If `Focal Length` is selected, options are `4.15 mm`, `greater than 4.15 mm`, `less than 4.15 mm`.
	- If `Lens Aperture` is selected, options are `2.28`, `greater than 2.28`, `less than 2.28`.
	- If `Zoom-in Degree` is selected, options are `zoom in` and `no zoom`.
	- If `Exposure Time`, is selected, options are `1 ms and less` and `larger than 1 ms`
	- If `Megapixel` is selected, options are `larger than 2 and less than 12 megapixels`, `larger than 12 megapixels`, and `2 megapixels or less`
	- If `Pixel Size` is selected, options are `(3264, 2448)`, `(1632, 1224)`, and `(4000, 3000)`, etc.

You can also save the table in your local machine. 